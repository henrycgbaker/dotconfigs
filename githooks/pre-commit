#!/bin/bash
# ============================================================================
# PRE-COMMIT HOOK
# ============================================================================
# Location: .git/hooks/pre-commit (NOT tracked by git)
# Source:   githooks/pre-commit (tracked template)
#
# Install: cp githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit
# Or run:  ./setup.sh (does this automatically)
# ============================================================================

REPO_ROOT="$(git rev-parse --show-toplevel)"

# --- Identity Check ---
EXPECTED_NAME="henrycgbaker"
EXPECTED_EMAIL="henry.c.g.baker@gmail.com"

ACTUAL_NAME=$(git config user.name)
ACTUAL_EMAIL=$(git config user.email)

if [ "$ACTUAL_NAME" != "$EXPECTED_NAME" ]; then
    echo "âŒ ERROR: Git user.name is '$ACTUAL_NAME', expected '$EXPECTED_NAME'"
    echo "Fix with: git config user.name '$EXPECTED_NAME'"
    exit 1
fi

if [ "$ACTUAL_EMAIL" != "$EXPECTED_EMAIL" ]; then
    echo "âŒ ERROR: Git user.email is '$ACTUAL_EMAIL', expected '$EXPECTED_EMAIL'"
    echo "Fix with: git config user.email '$EXPECTED_EMAIL'"
    exit 1
fi

# --- Agent Sync (dotclaude only) ---
if [ -x "$REPO_ROOT/sync-project-agents.sh" ]; then
    echo "ðŸ”„ Syncing project agents..."
    "$REPO_ROOT/sync-project-agents.sh" pull 2>/dev/null
    git add "$REPO_ROOT/project-agents/" 2>/dev/null || true
    echo "âœ… Agent sync complete"
fi

exit 0
