#!/bin/bash
# Global commit-msg hook: Block AI attribution in commits
# Deployed via: git config --global core.hooksPath ~/.claude/githooks

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Block AI attribution patterns (but allow product name mentions)
# These patterns indicate AI-generated attribution, not product references
AI_PATTERNS=(
    "Co-Authored-By:.*Claude"
    "Co-Authored-By:.*GPT"
    "Co-Authored-By:.*AI"
    "Generated by Claude"
    "Generated by GPT"
    "Generated with Claude"
    "Generated with GPT"
    "ü§ñ.*Generated"
    "Written by AI"
    "AI-assisted"
)

for pattern in "${AI_PATTERNS[@]}"; do
    if echo "$COMMIT_MSG" | grep -qiE "$pattern"; then
        echo "‚ùå ERROR: Commit message contains AI attribution"
        echo "Pattern matched: $pattern"
        echo "Please remove AI attribution from commit message."
        exit 1
    fi
done

# Source repo-specific commit-msg if it exists
REPO_HOOK="$(git rev-parse --show-toplevel)/.githooks/commit-msg"
if [ -x "$REPO_HOOK" ]; then
    "$REPO_HOOK" "$COMMIT_MSG_FILE"
fi

exit 0
