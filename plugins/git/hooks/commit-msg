#!/usr/bin/env bash
# === METADATA ===
# NAME: commit-msg
# TYPE: git-hook
# PLUGIN: git
# DESCRIPTION: Blocks AI attribution patterns in commit messages
# CONFIGURABLE: none
# ================

set -e

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Block AI attribution patterns
AI_PATTERNS=(
    "Co-Authored-By:.*Claude"
    "Co-Authored-By:.*GPT"
    "Co-Authored-By:.*AI"
    "Generated by Claude"
    "Generated by GPT"
    "Generated with Claude"
    "Generated with GPT"
    "ü§ñ.*Generated"
    "Written by AI"
    "AI-assisted"
)

for pattern in "${AI_PATTERNS[@]}"; do
    if echo "$COMMIT_MSG" | grep -qiE "$pattern"; then
        echo "‚ùå ERROR: Commit message contains AI attribution"
        echo "Pattern matched: $pattern"
        echo "Please remove AI attribution from commit message."
        exit 1
    fi
done

# Source project-specific commit-msg if it exists
if [ -x .git/hooks/commit-msg.local ]; then
    .git/hooks/commit-msg.local "$COMMIT_MSG_FILE"
fi

exit 0
