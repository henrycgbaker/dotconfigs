---
phase: 003
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/git/setup.sh
autonomous: true
---

<objective>
Fix Git wizard UX issues from UAT Test 6: confusing prompt format, alias wording, config path labels, summary destination, and missing config path option.

Covers:
- 6a: Fix confusing prompt format — '(default: value) [Y/n]' mixes opt-in question with config value. Show value only after user opts in.
- 6b: Alias wording — 'manage' should be 'add'
- 6d: Config path options should indicate tracked vs untracked
- 6e: Summary should show destination path (greyed out 'written to .env')
- 6f: Should offer .claude/hooks.conf as config path option

DEFERRED (major rearchitecture):
- 6c: Per-hook granularity for scope (global vs project) and location — this requires fundamental changes to the hook deployment model. Current all-or-nothing scope is functional. Defer to a future phase.

Purpose: Make the Git wizard prompts clear and consistent.
Output: Updated plugins/git/setup.sh
</objective>

<context>
@plugins/git/setup.sh
@lib/wizard.sh
@lib/colours.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix prompt format and alias wording</name>
  <files>plugins/git/setup.sh</files>
  <action>
1. **Fix confusing prompt format (6a):**
   The workflow section has prompts like:
   ```
   Manage pull.rebase? (default: true) [Y/n]:
   ```
   This confuses "do you want to manage this setting?" (yes/no question) with "what is the default value?" (true).

   Fix: Split into two-step flow. First ask "Manage X?" with just [Y/n]. If yes, THEN show the current/default value and ask for input.

   In `_git_wizard_workflow()`:
   - Change each setting block from:
     ```bash
     if wizard_yesno "  Manage pull.rebase? (default: true)" "..."; then
         wizard_prompt "    pull.rebase value [true/false]" "$pull_rebase_default" GIT_PULL_REBASE
     ```
   - To:
     ```bash
     if wizard_yesno "  Manage pull.rebase?" "..."; then
         wizard_prompt "    pull.rebase" "$pull_rebase_default" GIT_PULL_REBASE
     ```
   - The `wizard_prompt` already shows `[default_value]` in its prompt, so the user sees the default after opting in.
   - Apply this pattern to ALL workflow settings: pull.rebase, push.default, fetch.prune, init.defaultBranch, rerere.enabled, diff.algorithm, help.autocorrect.

2. **Fix alias wording (6b):**
   - In `_git_wizard_aliases()`, change the header echo from "Configure git command aliases" to "Add git command aliases"
   - Change "Default aliases (select which to manage):" to "Default aliases (select which to add):"
   - Change "Add custom aliases?" wording is already fine.

3. **Pre-fill defaults for opt-in questions:**
   For the wizard_yesno calls, the current logic uses expressions like:
   ```bash
   "$([ "$pull_rebase_default" != "false" ] && echo y || echo n)"
   ```
   This defaults to "y" if value exists. For first-run (no .env), this means everything defaults to Y which is confusing — user is asked to "manage" settings they haven't configured yet.

   Fix: Default to "n" for first run (when var is unset), "y" when var has a value from .env:
   ```bash
   local manage_default="n"
   [[ -n "${GIT_PULL_REBASE:-}" ]] && manage_default="y"
   if wizard_yesno "  Manage pull.rebase?" "$manage_default"; then
   ```
   Apply to all workflow settings.
  </action>
  <verify>Run `bash -n plugins/git/setup.sh` for syntax check. Grep for "default:" in setup.sh — should appear 0 times in wizard_yesno calls.</verify>
  <done>Workflow prompts cleanly separate opt-in question from value configuration. Alias wording uses "add" not "manage".</done>
</task>

<task type="auto">
  <name>Task 2: Config path labels, summary path, and .claude/hooks.conf option</name>
  <files>plugins/git/setup.sh</files>
  <action>
1. **Config path indicators for tracked vs untracked (6d):**
   In `_git_wizard_hooks()`, the hook config path options currently show:
   ```
   1) .githooks/config
   2) .claude/git-hooks.conf
   3) .git/hooks/hooks.conf
   4) Custom path
   ```
   Add tracked/untracked indicators:
   ```
   1) .githooks/config         (tracked — committed to repo)
   2) .claude/git-hooks.conf   (tracked — committed to repo)
   3) .claude/hooks.conf       (tracked — committed to repo)
   4) .git/hooks/hooks.conf    (untracked — per-clone only)
   5) Custom path
   ```

2. **Add .claude/hooks.conf as config path option (6f):**
   - Add `.claude/hooks.conf` as option 3 (shift others down).
   - Update the case statement to handle 5 options instead of 4.
   - Update read prompt to say `[1-5, default: 1]`.

3. **Summary should show destination path (6e):**
   In `_git_wizard_summary()`, at the very end (after the hooks section), add a dim/greyed line:
   ```bash
   printf "  %b\n" "$(colour_dim "written to: .env")"
   ```
   Wait — `colour_dim` doesn't exist. Use the COLOUR_DIM variable directly:
   ```bash
   printf "\n  %b%s%b\n" "$COLOUR_DIM" "Settings will be saved to .env" "$COLOUR_RESET"
   ```
   This requires `init_colours` to have been called (it is, at top of plugin_git_setup).
  </action>
  <verify>Run `bash -n plugins/git/setup.sh` for syntax check. Grep for "hooks.conf" — should appear in config path options.</verify>
  <done>Config path options show tracked/untracked labels, .claude/hooks.conf is available as option 3, summary shows destination path.</done>
</task>

</tasks>

<verification>
- `bash -n plugins/git/setup.sh` — no syntax errors
- Grep for `(default:` in wizard_yesno calls — should be 0 occurrences
- Grep for `manage` in aliases section — should only appear in variable names, not user-facing text
- Grep for `.claude/hooks.conf` — should appear as config path option
</verification>

<success_criteria>
- Workflow prompts separate opt-in from value setting
- First-run defaults to "n" for manage questions (opt-in model)
- Alias section says "add" not "manage"
- Config path options show tracked/untracked labels
- .claude/hooks.conf is a config path option
- Summary shows "written to .env" in dim text
</success_criteria>
