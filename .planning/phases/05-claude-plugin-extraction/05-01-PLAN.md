---
phase: 05-claude-plugin-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/claude/templates/claude-md/01-communication.md
  - plugins/claude/templates/claude-md/02-simplicity.md
  - plugins/claude/templates/claude-md/03-documentation.md
  - plugins/claude/templates/claude-md/04-git.md
  - plugins/claude/templates/claude-md/05-code-style.md
  - plugins/claude/templates/settings/base.json
  - plugins/claude/templates/settings/node.json
  - plugins/claude/templates/settings/python.json
  - plugins/claude/templates/hooks-conf/default.conf
  - plugins/claude/templates/hooks-conf/permissive.conf
  - plugins/claude/templates/hooks-conf/strict.conf
  - plugins/claude/hooks/post-tool-format.py
  - plugins/claude/commands/commit.md
  - plugins/claude/commands/squash-merge.md
  - plugins/claude/commands/simplicity-check.md
  - plugins/claude/commands/pr-review.md
  - plugins/claude/DESCRIPTION
  - lib/discovery.sh
  - lib/symlinks.sh
autonomous: true

must_haves:
  truths:
    - "Templates, hooks, and commands live under plugins/claude/"
    - "Discovery functions find assets in new plugin-relative paths"
    - "Existing assets at root level are removed (no duplication)"
    - "All 'dotclaude' references in lib/ renamed to 'dotconfigs'"
  artifacts:
    - path: "plugins/claude/templates/claude-md/01-communication.md"
      provides: "CLAUDE.md section template"
    - path: "plugins/claude/hooks/post-tool-format.py"
      provides: "Claude Code hook"
    - path: "plugins/claude/commands/commit.md"
      provides: "Slash command skill"
    - path: "plugins/claude/DESCRIPTION"
      provides: "Plugin metadata for dotconfigs list"
    - path: "lib/discovery.sh"
      provides: "Updated discovery with plugin-relative paths"
    - path: "lib/symlinks.sh"
      provides: "Symlink management with dotconfigs naming"
  key_links:
    - from: "lib/discovery.sh"
      to: "plugins/claude/hooks/"
      via: "discover_hooks uses plugin_dir parameter"
      pattern: "discover_hooks.*plugin"
    - from: "lib/discovery.sh"
      to: "plugins/claude/templates/claude-md/"
      via: "discover_claude_sections uses plugin_dir"
      pattern: "discover_claude_sections.*plugin"
---

<objective>
Move all Claude-specific assets (templates, hooks, commands) from root-level directories into plugins/claude/ and update discovery functions to find them at the new paths.

Purpose: CLPL-03 requires assets under plugins/claude/. This is the foundation that setup and deploy plans depend on — they need to reference assets at plugin-relative paths.

Output: All Claude assets relocated under plugins/claude/, discovery functions updated, root-level asset dirs removed, DESCRIPTION file created, all `dotclaude` references in lib/ renamed to `dotconfigs`.
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-claude-plugin-extraction/05-CONTEXT.md
@.planning/phases/05-claude-plugin-extraction/05-RESEARCH.md
@lib/discovery.sh
@lib/symlinks.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move assets into plugins/claude/</name>
  <files>
    plugins/claude/templates/claude-md/*.md
    plugins/claude/templates/settings/*.json
    plugins/claude/templates/hooks-conf/*.conf
    plugins/claude/hooks/post-tool-format.py
    plugins/claude/commands/commit.md
    plugins/claude/commands/squash-merge.md
    plugins/claude/commands/simplicity-check.md
    plugins/claude/commands/pr-review.md
    plugins/claude/DESCRIPTION
  </files>
  <action>
    Use `git mv` to move assets from root-level directories into plugins/claude/:

    1. Move templates:
       - `git mv templates/claude-md plugins/claude/templates/claude-md`
       - `git mv templates/settings plugins/claude/templates/settings`
       - `git mv templates/hooks-conf plugins/claude/templates/hooks-conf`
       - Remove empty `templates/` dir after moves

    2. Move hooks:
       - `git mv hooks/post-tool-format.py plugins/claude/hooks/post-tool-format.py`
       - Remove empty `hooks/` dir after move

    3. Move commands:
       - `git mv commands/commit.md plugins/claude/commands/commit.md`
       - `git mv commands/squash-merge.md plugins/claude/commands/squash-merge.md`
       - `git mv commands/simplicity-check.md plugins/claude/commands/simplicity-check.md`
       - `git mv commands/pr-review.md plugins/claude/commands/pr-review.md`
       - Remove empty `commands/` dir after moves

    4. Create `plugins/claude/DESCRIPTION` with one line: "Claude Code configuration (CLAUDE.md, settings, hooks, skills)"

    Create the target subdirectories first if they don't exist (mkdir -p).

    Note: The root `settings.json` file stays — it's the global settings template, not a plugin asset. The `githooks/` directory stays — it contains git hooks (Phase 6 territory), not Claude Code hooks.
  </action>
  <verify>
    - `ls plugins/claude/templates/claude-md/` shows 5 .md files
    - `ls plugins/claude/templates/settings/` shows 3 .json files
    - `ls plugins/claude/templates/hooks-conf/` shows 3 .conf files
    - `ls plugins/claude/hooks/` shows post-tool-format.py
    - `ls plugins/claude/commands/` shows 4 .md files
    - `cat plugins/claude/DESCRIPTION` shows description text
    - `ls templates/ 2>/dev/null` returns nothing (dir removed)
    - `ls hooks/ 2>/dev/null` returns nothing (dir removed) — note: hooks/ not githooks/
    - `ls commands/ 2>/dev/null` returns nothing (dir removed)
  </verify>
  <done>All Claude-specific assets relocated under plugins/claude/ with no duplication at root level</done>
</task>

<task type="auto">
  <name>Task 2: Update discovery functions for plugin-relative paths</name>
  <files>lib/discovery.sh</files>
  <action>
    Update `lib/discovery.sh` so the legacy discovery functions accept a plugin directory as their base path instead of hardcoding root-level paths. The key change: callers will pass `$PLUGINS_DIR/claude` instead of `$SCRIPT_DIR`.

    Update these functions:

    1. `discover_hooks($plugin_dir)` — change `hooks_dir` from `$dotclaude_root/hooks` to `$plugin_dir/hooks`. Keep parameter name as `plugin_dir` for clarity. Keep searching for *.py and *.sh.

    2. `discover_skills($plugin_dir)` — change `commands_dir` from `$dotclaude_root/commands` to `$plugin_dir/commands`. Keep searching for *.md, stripping extension.

    3. `discover_claude_sections($plugin_dir)` — change `templates_dir` from `$dotclaude_root/templates/claude-md` to `$plugin_dir/templates/claude-md`. Keep the sed pattern for extracting section names.

    4. `discover_settings_templates($plugin_dir)` — change `templates_dir` from `$dotclaude_root/templates/settings` to `$plugin_dir/templates/settings`. Keep searching for *.json.

    5. `discover_githooks` — leave unchanged (git hooks stay in root `githooks/` dir, Phase 6 territory).

    The parameter rename is the only change — the internal logic (find, basename, sed) stays identical. This is purely a path update so setup.sh and deploy.sh can call `discover_hooks "$PLUGINS_DIR/claude"`.

    Also add a new function `discover_hooks_conf_profiles($plugin_dir)` that lists available hooks.conf profiles from `$plugin_dir/templates/hooks-conf/`, stripping .conf extension. Pattern matches the existing `discover_settings_templates` function.
  </action>
  <verify>
    - `grep -c 'plugin_dir' lib/discovery.sh` shows the parameter is used in updated functions
    - `grep 'dotclaude_root' lib/discovery.sh` shows only `discover_githooks` still uses old name
    - `grep 'discover_hooks_conf_profiles' lib/discovery.sh` finds the new function
    - `bash -n lib/discovery.sh` returns 0 (no syntax errors)
  </verify>
  <done>Discovery functions accept plugin directory paths; new hooks-conf profile discovery function added; all bash 3.2 compatible</done>
</task>

<task type="auto">
  <name>Task 3: Rename dotclaude references to dotconfigs in lib/</name>
  <files>lib/symlinks.sh, lib/discovery.sh</files>
  <action>
    The repo has been renamed from dotclaude to dotconfigs. Update all `dotclaude` references in the shared library layer to match.

    **lib/symlinks.sh:**
    - Rename function `is_dotclaude_owned()` → `is_dotconfigs_owned()`
    - Rename variable `dotclaude_path` → `dotconfigs_path`
    - Rename variable `dotclaude_root` → `dotconfigs_root`
    - Update comments: "dotclaude repo" → "dotconfigs repo", "owned by dotclaude" → "owned by dotconfigs", "managed by dotclaude" → "managed by dotconfigs"
    - Update user-facing string: `"not managed by dotclaude"` → `"not managed by dotconfigs"`

    **lib/discovery.sh:**
    - Rename parameter `dotclaude_root` → `plugin_dir` in all updated functions (this overlaps with Task 2 — Task 2 changes the path logic, this task ensures no `dotclaude` naming survives)
    - For `discover_githooks` which stays root-scoped: rename parameter from `dotclaude_root` → `dotconfigs_root`
    - Update comments: "Args: dotclaude_root" → appropriate new name

    Also grep the `dotconfigs` entry point script and any other files under `lib/` for stray `dotclaude` references and update them.

    Note: `scripts/lib/` and `deploy.sh` still contain `dotclaude` references but are being deleted in Plan 05-05, so leave those alone.
  </action>
  <verify>
    - `grep -r 'dotclaude' lib/` returns nothing
    - `grep 'is_dotconfigs_owned' lib/symlinks.sh` finds the renamed function
    - `grep 'dotconfigs_root\|dotconfigs_path' lib/symlinks.sh` finds renamed variables
    - `grep 'managed by dotconfigs' lib/symlinks.sh` finds updated user-facing string
    - `bash -n lib/symlinks.sh && bash -n lib/discovery.sh` both return 0
  </verify>
  <done>All dotclaude references in lib/ renamed to dotconfigs; function names, variables, comments, and user-facing strings updated</done>
</task>

</tasks>

<verification>
- All Claude assets exist under plugins/claude/ (templates, hooks, commands)
- No Claude assets remain at root level (templates/, hooks/, commands/ dirs removed)
- Discovery functions reference plugin-relative paths
- No bash 4+ syntax introduced
- DESCRIPTION file exists for `dotconfigs list` output
- No `dotclaude` references remain in lib/ (functions, variables, comments, strings all renamed)
</verification>

<success_criteria>
- `find plugins/claude -type f | wc -l` returns at least 13 files (5 templates + 3 settings + 3 hooks-conf + 1 hook + 4 commands + 1 DESCRIPTION = 17)
- `bash -n lib/discovery.sh && bash -n lib/symlinks.sh` both pass
- Root-level templates/, hooks/, commands/ directories no longer exist
- `grep -r 'dotclaude' lib/` returns nothing
</success_criteria>

<output>
After completion, create `.planning/phases/05-claude-plugin-extraction/05-01-SUMMARY.md`
</output>
