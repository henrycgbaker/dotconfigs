---
phase: 09-config-ux-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/colours.sh
  - lib/wizard.sh
  - plugins/claude/templates/settings/settings-template.json
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Colour helpers exist for G/L provenance badges (cyan for Global, green for Local)"
    - "Wizard helpers support opt-in category menu, edit-mode display, and config toggle patterns"
    - "Complete settings.json template exists in plugins/claude/templates/ as public reference"
    - "Root settings.json is listed in .gitignore"
  artifacts:
    - path: "lib/colours.sh"
      provides: "G/L provenance badge colour helpers"
      contains: "colour_badge_global"
    - path: "lib/wizard.sh"
      provides: "Opt-in wizard helpers for category menus and edit mode"
      contains: "wizard_category_menu"
    - path: "plugins/claude/templates/settings-template.json"
      provides: "Complete public settings.json template"
    - path: ".gitignore"
      provides: "Root settings.json exclusion"
      contains: "settings.json"
  key_links:
    - from: "lib/colours.sh"
      to: "plugins/*/setup.sh"
      via: "sourced by entry point"
      pattern: "colour_badge"
---

<objective>
Add shared infrastructure for the opt-in wizard UX: G/L provenance colour helpers in lib/colours.sh, opt-in wizard helper functions in lib/wizard.sh, complete settings.json template, and .gitignore entry for root settings.json.

Purpose: Plans 03-05 depend on these shared helpers. Colour badges, category menus, and edit-mode display are reused across both plugin wizards.
Output: Extended lib/colours.sh, extended lib/wizard.sh, settings.json template, updated .gitignore.
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/colours.sh
@lib/wizard.sh
@settings.json
@plugins/claude/templates/settings/base.json
@plugins/claude/templates/settings/python.json
@plugins/claude/templates/settings/node.json
@plugins/claude/templates/settings/hooks.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add G/L provenance badge helpers to lib/colours.sh</name>
  <files>lib/colours.sh</files>
  <action>
Add two new helper functions to lib/colours.sh for provenance badges:

```bash
# Print a Global provenance badge [G] in cyan
# Args: none
colour_badge_global() {
    printf "%b[G]%b" "$COLOUR_CYAN" "$COLOUR_RESET"
}

# Print a Local provenance badge [L] in green
# Args: none
colour_badge_local() {
    printf "%b[L]%b" "$COLOUR_GREEN" "$COLOUR_RESET"
}

# Print a "not managed" label in dim/grey
# Args: none
colour_not_managed() {
    printf "\033[2m[not managed]\033[0m"
}
```

Also add a dim colour constant to `init_colours()`:
- TTY: `COLOUR_DIM='\033[2m'`
- Non-TTY: `COLOUR_DIM=''`

These are used by the opt-in wizard to show provenance in summaries and the project-configs wizard to show global values.
  </action>
  <verify>
- `grep -c "colour_badge_global" lib/colours.sh` returns at least 1
- `grep -c "colour_badge_local" lib/colours.sh` returns at least 1
- `grep -c "colour_not_managed" lib/colours.sh` returns at least 1
- `grep -c "COLOUR_DIM" lib/colours.sh` returns at least 2 (TTY + non-TTY)
  </verify>
  <done>
G/L badge helpers and dim colour constant exist in lib/colours.sh.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add opt-in wizard helpers to lib/wizard.sh + settings template + gitignore</name>
  <files>lib/wizard.sh, plugins/claude/templates/settings-template.json, .gitignore</files>
  <action>
**Part A: Add wizard helpers to lib/wizard.sh**

Add these helper functions for the opt-in category wizard UX:

1. **`wizard_category_menu`** — Display a numbered category menu using read (not select). Args: title, category_names (array name). Returns selected index via exit code (0-based). Uses a while loop with read prompt and validates input range.

2. **`wizard_edit_mode_display`** — Display current configuration in edit mode format. Args: config_labels (array name), config_values (array name), config_managed (array name, "true"/"false" per item). Prints numbered list with values or `[not managed]` for unmanaged items. Returns nothing (display only).

3. **`wizard_parse_edit_selection`** — Parse comma-separated number input for edit mode. Args: input_string, max_index. Prints space-separated list of valid 0-based indices. Handles whitespace, validates range, deduplicates.

4. **`wizard_config_toggle`** — Display a list of configs in a category and let user toggle which to manage. Args: title, config_names (array name), selected (array name). Shows `[x]`/`[ ]` checkboxes. User enters numbers to toggle, 'done' to finish, 'all' to select all, 'none' to deselect all. Updates the selected array in-place. This is similar to existing `wizard_checkbox_menu` but with 'none' option and cleaner formatting.

**Part B: Create complete settings.json template**

Create `plugins/claude/templates/settings-template.json` as a complete working example with ALL common rules. This is the public template (users delete what they don't want). Include:
- Core permissions (deny secrets, ask .env)
- Python rules (ruff, pytest, pip, python — allow)
- Node rules (npm, npx, node, pnpm — allow)
- Sandbox settings (enabled, excluded commands)
- Hooks section (PostToolUse ruff format, PreToolUse empty array)
- Environment variables (PYTHONDONTWRITEBYTECODE, PYTHONUNBUFFERED)
- System commands (git allow, docker allow)
- Comment note at top explaining this is a template

NOTE: JSON doesn't support comments, so add a `"_template_note"` key at the top explaining this is a reference template.

**Part C: Add settings.json to .gitignore**

Read the existing `.gitignore` file. Add `settings.json` entry if not already present. This prevents the personal root `settings.json` (which contains user-specific rules like nvidia-smi, docker, /proc/* reads) from being committed when the repo goes public.
  </action>
  <verify>
- `grep -c "wizard_category_menu" lib/wizard.sh` returns at least 1
- `grep -c "wizard_edit_mode_display" lib/wizard.sh` returns at least 1
- `grep -c "wizard_parse_edit_selection" lib/wizard.sh` returns at least 1
- `grep -c "wizard_config_toggle" lib/wizard.sh` returns at least 1
- `test -f plugins/claude/templates/settings-template.json && echo "exists"`
- `grep -q "settings.json" .gitignore && echo "gitignored"`
  </verify>
  <done>
- Four new wizard helper functions exist in lib/wizard.sh
- Complete settings.json template exists at plugins/claude/templates/settings-template.json
- Root settings.json is listed in .gitignore
  </done>
</task>

</tasks>

<verification>
- lib/colours.sh has G/L badge helpers
- lib/wizard.sh has category menu and edit mode helpers
- Settings template exists and is valid JSON
- .gitignore contains settings.json
- No bash 4+ syntax used (no namerefs, no associative arrays, no ${var,,})
</verification>

<success_criteria>
1. Colour badge helpers ready for use by wizard plans
2. Wizard category/edit helpers ready for use by wizard plans
3. Complete settings.json template exists as public reference
4. Root settings.json gitignored
</success_criteria>

<output>
After completion, create `.planning/phases/09-config-ux-redesign/09-02-SUMMARY.md`
</output>
