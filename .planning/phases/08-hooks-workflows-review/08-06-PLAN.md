---
phase: 08-hooks-workflows-review
plan: 06
type: execute
wave: 4
depends_on: ["08-03", "08-04", "08-05"]
files_modified:
  - scripts/generate-roster.sh
  - docs/ROSTER.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "Roster generation script reads metadata from all hook/command files and produces ROSTER.md"
    - "ROSTER.md lists all hooks, tools, configs, and workflows with descriptions and config keys"
    - "README includes brief GSD framework mention (2-3 lines)"
    - "README links to ROSTER.md"
    - "Roster updates automatically when hooks are added (script re-run)"
    - "Configuration hierarchy is documented in README: three tiers (hardcoded defaults, global .env, project config), when to use each, plugin config ownership, and discovery paths"
  artifacts:
    - path: "scripts/generate-roster.sh"
      provides: "Auto-generation script for ROSTER.md"
      contains: "METADATA"
    - path: "docs/ROSTER.md"
      provides: "Complete roster of all hooks, tools, configs"
      contains: "pre-commit"
    - path: "README.md"
      provides: "Updated README with GSD mention and roster link"
      contains: "GSD"
  key_links:
    - from: "scripts/generate-roster.sh"
      to: "plugins/*/hooks/*"
      via: "metadata header parsing"
      pattern: "=== METADATA ==="
    - from: "README.md"
      to: "docs/ROSTER.md"
      via: "markdown link"
      pattern: "ROSTER.md"
---

<objective>
Create auto-generated roster documentation from hook metadata headers and update README with GSD framework mention.

Purpose: The roster document provides a single reference for all available hooks, tools, and configuration options. Auto-generation from metadata headers ensures it stays in sync as hooks are added. The README needs a brief GSD mention per the pending todos.

Output: Generation script, ROSTER.md, updated README.
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-hooks-workflows-review/08-03-SUMMARY.md
@.planning/phases/08-hooks-workflows-review/08-04-SUMMARY.md
@.planning/phases/08-hooks-workflows-review/08-05-SUMMARY.md
@README.md
@plugins/git/hooks/commit-msg
@plugins/claude/hooks/block-destructive.sh
@plugins/claude/commands/squash-merge.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create roster generation script</name>
  <files>scripts/generate-roster.sh</files>
  <action>
Create `scripts/generate-roster.sh` — a bash script that reads metadata headers from all hook and command files, then generates `docs/ROSTER.md`.

**Script structure:**

1. Shebang: `#!/bin/bash` (this IS executed directly)
2. Set script dir and repo root
3. Create/overwrite `docs/ROSTER.md`

**Metadata parsing:**

For each file in:
- `plugins/*/hooks/*` (git hooks and claude hooks)
- `plugins/*/commands/*.md` (claude commands/skills)

Parse the `# === METADATA ===` block (hooks) or YAML frontmatter (commands) to extract:
- NAME
- TYPE (git-hook, claude-hook, command)
- PLUGIN
- DESCRIPTION
- CONFIGURABLE (comma-separated list of config keys)

For command files (.md), parse the YAML frontmatter:
- `description:` field → DESCRIPTION
- filename without extension → NAME
- TYPE = "command"
- PLUGIN = parent directory name

**Output format (`docs/ROSTER.md`):**

```markdown
# dotconfigs Roster

> Auto-generated by `scripts/generate-roster.sh` — do not edit manually.
> Re-generate: `./scripts/generate-roster.sh`

## Git Hooks

| Hook | Description | Config Keys |
|------|-------------|-------------|
| commit-msg | Validates commit messages — AI attribution blocking and conventional commit enforcement | GIT_HOOK_BLOCK_AI_ATTRIBUTION, ... |
| pre-commit | Pre-commit checks — secrets detection, large file warnings, debug statement detection | GIT_HOOK_SECRETS_CHECK, ... |
| ... | ... | ... |

## Claude Code Hooks

| Hook | Description | Config Keys |
|------|-------------|-------------|
| block-destructive | Blocks destructive CLI commands and protects sensitive file paths | CLAUDE_HOOK_DESTRUCTIVE_GUARD, ... |
| post-tool-format | Auto-formats Python files with Ruff after Write/Edit | CLAUDE_HOOK_RUFF_FORMAT |

## Commands (Skills)

| Command | Description |
|---------|-------------|
| /commit | ... |
| /squash-merge | ... |
| ... | ... |

## Configuration Reference

### Global Configuration (.env)

All settings can be configured in the dotconfigs `.env` file. Run `dotconfigs setup <plugin>` to use the interactive wizard.

### Per-Project Configuration

Project-level overrides are stored in the git hook config file (location selected during setup). These override global .env values.

**Precedence:** project config > global .env > hardcoded defaults

### Variable Reference

| Variable | Default | Description |
|----------|---------|-------------|
| GIT_HOOK_COMMIT_MSG_ENABLED | true | Enable/disable commit-msg hook |
| GIT_HOOK_BLOCK_AI_ATTRIBUTION | true | Block AI attribution in commit messages |
| ... | ... | ... |
```

**Implementation details:**
- Use `grep` to find METADATA blocks: `grep -l '=== METADATA ===' plugins/*/hooks/*`
- Use `sed` to extract fields between METADATA markers
- Sort by plugin, then by type, then by name
- The variable reference table should be built from the CONFIGURABLE fields, plus hardcoded defaults from `lib/config.sh`
- Handle `post-tool-format.py` which doesn't have a METADATA block yet — add one, or parse its docstring

**For post-tool-format.py:** Add a metadata block as a Python comment at the top (after the shebang and docstring):
```python
# === METADATA ===
# NAME: post-tool-format
# TYPE: claude-hook
# PLUGIN: claude
# DESCRIPTION: Auto-formats Python files with Ruff after Write/Edit
# CONFIGURABLE: CLAUDE_HOOK_RUFF_FORMAT
# ================
```

**Bash 3.2 compatible.** No associative arrays — use indexed arrays or simple variables.
  </action>
  <verify>
- `bash -n scripts/generate-roster.sh` passes
- `bash scripts/generate-roster.sh` runs and produces docs/ROSTER.md
- `test -f docs/ROSTER.md` confirms output exists
- `grep -c '|' docs/ROSTER.md` returns 10+ (tables generated)
- `grep 'commit-msg' docs/ROSTER.md` finds git hooks
- `grep 'block-destructive' docs/ROSTER.md` finds claude hooks
- `grep 'squash-merge' docs/ROSTER.md` finds commands
- `grep 'Auto-generated' docs/ROSTER.md` finds the header
- `grep -E 'local -n|declare -n' scripts/generate-roster.sh` returns nothing
  </verify>
  <done>Generation script parses metadata from all hooks and commands, produces comprehensive ROSTER.md with tables for hooks, commands, and configuration reference.</done>
</task>

<task type="auto">
  <name>Task 2: Update README with GSD mention and roster link</name>
  <files>README.md, plugins/claude/hooks/post-tool-format.py</files>
  <action>
**Update README.md:**

1. **Add GSD framework mention** — Insert a brief section after the "Plugins" section (before "Configuration"):
```markdown
## GSD Framework

dotconfigs supports the [Get Shit Done (GSD)](https://github.com/henrycgbaker/get-shit-done) planning and execution framework for Claude Code. GSD provides structured phase planning, task breakdown, and execution workflows.

To enable, run `dotconfigs setup claude` and select "Install GSD framework" during the wizard.
```
This is 3 lines as specified by the user decision.

2. **Add roster link** — In the "Configuration" section, add a line:
```markdown
For a complete list of all hooks, commands, and configuration options, see [docs/ROSTER.md](docs/ROSTER.md).
```

3. **Add Configuration hierarchy section** — Add a "Configuration" section (or expand the existing one) that comprehensively documents the three-tier hierarchy. This satisfies success criterion 7 ("Configuration hierarchy documented"):
```markdown
## Configuration

### Hierarchy

dotconfigs uses a three-tier configuration hierarchy with clear precedence:

| Tier | Location | Scope | Set by |
|------|----------|-------|--------|
| 1. Hardcoded defaults | Built into hook scripts | Universal | dotconfigs maintainer |
| 2. Global `.env` | `dotconfigs/.env` | All projects | `dotconfigs setup <plugin>` wizard |
| 3. Project config | Per-project config file | Single repo | `dotconfigs project` wizard |

**Precedence:** Project config > Global .env > Hardcoded defaults

Higher tiers override lower tiers. If a setting is not specified at a tier, the next lower tier's value is used.

### When to use each tier

- **Hardcoded defaults** — Sensible out-of-the-box values. You never edit these directly; they exist as fallbacks.
- **Global `.env`** — Your personal preferences across all projects. Run `dotconfigs setup git` or `dotconfigs setup claude` to configure interactively.
- **Project config** — Per-repo overrides when a project needs different settings. Run `dotconfigs project` to configure.

### Plugin config ownership

Each plugin owns its own configuration files:

- **Git plugin** deploys `git-hooks.conf` (location selected during setup: `.githooks/config`, `.claude/git-hooks.conf`, or `.git/hooks/hooks.conf`)
- **Claude plugin** deploys `.claude/claude-hooks.conf`

Hooks discover their config file by searching known paths in order. The selected path is stored in `.dotconfigs.json` for consistency.

### Discovery paths (git hooks)

Git hooks search for config in this order:
1. `$REPO_ROOT/.githooks/config`
2. `$REPO_ROOT/.claude/git-hooks.conf`
3. `$REPO_ROOT/.git/hooks/hooks.conf`
4. `$REPO_ROOT/.claude/hooks.conf` (backwards compatibility)
```

4. **Update hooks list in git plugin section** — Update the git plugin description to mention all 7 hooks:
```markdown
- Hooks — `commit-msg` (conventional commits, AI attribution), `pre-commit` (secrets, large files, debug statements), `pre-push` (branch protection), `prepare-commit-msg` (branch prefix), `post-merge` (dependency detection), `post-checkout` (branch info), `post-rewrite` (rebase detection)
```

5. **Update directory structure** — Add the new files:
   - `scripts/generate-roster.sh` under scripts/
   - `docs/ROSTER.md` under docs/
   - New hooks under plugins/git/hooks/
   - New hooks under plugins/claude/hooks/

**Update post-tool-format.py:**

Add metadata block as comments after the docstring (before the imports):
```python
# === METADATA ===
# NAME: post-tool-format
# TYPE: claude-hook
# PLUGIN: claude
# DESCRIPTION: Auto-formats Python files with Ruff after Write/Edit
# CONFIGURABLE: CLAUDE_HOOK_RUFF_FORMAT
# ================
```

This enables the roster generation script to discover and document it.
  </action>
  <verify>
- `grep 'GSD' README.md` finds the framework mention
- `grep 'ROSTER.md' README.md` finds the roster link
- `grep 'pre-commit.*secrets' README.md` finds updated hook list
- `grep 'generate-roster' README.md` finds script in directory structure
- `grep 'Hierarchy' README.md` finds the configuration hierarchy section
- `grep 'Project config.*Global.*Hardcoded' README.md` finds precedence documentation
- `grep 'Plugin config ownership' README.md` finds plugin config ownership section
- `grep 'Discovery paths' README.md` finds config discovery documentation
- `grep '=== METADATA ===' plugins/claude/hooks/post-tool-format.py` finds metadata block
- `bash scripts/generate-roster.sh` still works after post-tool-format.py update
  </verify>
  <done>README has GSD mention (3 lines), roster link, configuration hierarchy documentation (three tiers, when to use each, plugin config ownership, discovery paths), updated hook list, updated directory structure. post-tool-format.py has metadata header for auto-documentation.</done>
</task>

</tasks>

<verification>
1. `bash scripts/generate-roster.sh` produces docs/ROSTER.md without errors
2. docs/ROSTER.md contains tables for git hooks, claude hooks, and commands
3. README.md mentions GSD framework and links to ROSTER.md
4. README.md has Configuration section with hierarchy, precedence, plugin ownership, discovery paths
5. All hooks (git + claude) have metadata headers parseable by the generation script
6. Running `scripts/generate-roster.sh` twice produces identical output (idempotent)
</verification>

<success_criteria>
- Roster generation script works end-to-end (parses metadata, produces ROSTER.md)
- ROSTER.md is a comprehensive reference for all hooks, commands, and config
- README includes GSD framework mention (2-3 lines per user decision)
- README links to ROSTER.md
- README documents configuration hierarchy: three tiers, precedence, when to use each, plugin config ownership, discovery paths
- post-tool-format.py has metadata header
- Script and output are bash 3.2 compatible
</success_criteria>

<output>
After completion, create `.planning/phases/08-hooks-workflows-review/08-06-SUMMARY.md`
</output>
