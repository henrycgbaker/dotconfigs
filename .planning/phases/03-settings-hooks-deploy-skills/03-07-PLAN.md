---
phase: 03-settings-hooks-deploy-skills
plan: 07
type: execute
wave: 3
depends_on: ["03-05"]
files_modified:
  - scripts/registry-scan.sh
  - README.md
  - .gitignore
  - gitignore_global
autonomous: true

must_haves:
  truths:
    - "Registry scanner catalogues agents, skills, and rules from project .claude/ directories"
    - "Scanner reads paths from .env (SCAN_PATHS), no hardcoded defaults"
    - "Scanner outputs human-readable table by default, JSON with --json flag"
    - "README.md accurately describes the current repo structure and deploy.sh usage"
    - "setup.sh and deploy-remote.sh are deleted (replaced by deploy.sh)"
    - "gitignore_global is reviewed and updated for current needs"
  artifacts:
    - path: "scripts/registry-scan.sh"
      provides: "Registry scanning script"
      contains: "SCAN_PATHS"
    - path: "README.md"
      provides: "Updated project documentation"
      contains: "deploy.sh"
  key_links:
    - from: "scripts/registry-scan.sh"
      to: ".env"
      via: "reads SCAN_PATHS for directories to scan"
      pattern: "SCAN_PATHS"
---

<objective>
Create the registry scanner, rewrite README.md, and clean up replaced files.

Purpose: Completes RGST-01 (registry scanner), updates documentation to match the new deploy.sh system, and removes the old setup.sh/deploy-remote.sh scripts that have been replaced. This is the final cleanup plan.

Output: Working registry scanner, accurate README, clean repo with no dead scripts.
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-settings-hooks-deploy-skills/03-05-SUMMARY.md
@README.md
@setup.sh
@deploy-remote.sh
@gitignore_global
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create registry scanner</name>
  <files>scripts/registry-scan.sh</files>
  <action>
Create `scripts/registry-scan.sh` — a read-only scanning script that catalogues Claude Code configurations across projects.

**Invocation:**
```bash
./scripts/registry-scan.sh              # Human-readable table
./scripts/registry-scan.sh --json       # Machine-readable JSON
./scripts/registry-scan.sh --help       # Usage
```

**Configuration:**
- Read SCAN_PATHS from .env (comma-separated list of directories to scan)
- If no .env or SCAN_PATHS empty, print helpful error: "No scan paths configured. Run deploy.sh global to configure, or set SCAN_PATHS in .env"

**Scanning logic:**
For each path in SCAN_PATHS:
1. Find all directories containing `.claude/` subdirectory (use `find` with `-maxdepth 3` to avoid deep recursion)
2. For each project found, catalogue:
   - Project path
   - `.claude/settings.json` — exists? Is it a symlink?
   - `CLAUDE.md` — exists? Is it a symlink?
   - `.claude/hooks.conf` — exists? Settings?
   - `.claude/commands/` — what skills are present?
   - `.claude/agents/` — what agents are present?
   - `.claude/hooks/` — what hooks are present?
3. Determine sync status for each file:
   - If symlink pointing to dotclaude repo → "synced"
   - If regular file → "custom"
   - If missing → "missing"
   Use `is_dotclaude_owned` from scripts/lib/symlinks.sh for ownership detection.

**Table output format (default):**
```
Registry Scan — 3 projects found

Project                    Settings  CLAUDE.md  Hooks.conf  Skills  Status
─────────────────────────────────────────────────────────────────────────
~/Repos/project-a          synced    custom     default     3/3     OK
~/Repos/project-b          missing   missing    missing     0/3     Unmanaged
~/Repos/project-c          synced    synced     strict      3/3     OK
```

**JSON output format (--json):**
```json
{
  "scan_date": "2026-02-06",
  "scan_paths": ["~/Repositories"],
  "projects": [
    {
      "path": "~/Repos/project-a",
      "settings": {"status": "synced", "type": "symlink"},
      "claude_md": {"status": "custom", "type": "file"},
      "hooks_conf": {"status": "present", "profile": "default"},
      "skills": ["commit", "squash-merge", "simplicity-check"],
      "agents": []
    }
  ]
}
```

Source `scripts/lib/symlinks.sh` for `is_dotclaude_owned`. Source .env for SCAN_PATHS. Mark as executable.
  </action>
  <verify>
Syntax check: `bash -n scripts/registry-scan.sh && echo "Syntax OK"`

Check SCAN_PATHS usage: `grep "SCAN_PATHS" scripts/registry-scan.sh`

Check --json flag: `grep "\-\-json" scripts/registry-scan.sh`

Check ownership detection: `grep "is_dotclaude_owned" scripts/registry-scan.sh`

Check executable: `test -x scripts/registry-scan.sh && echo "Executable"`

Check no hardcoded scan paths: `! grep -E "~/Repositories|~/Projects" scripts/registry-scan.sh | grep -v "example\|help\|usage" && echo "No hardcoded paths"`
  </verify>
  <done>
scripts/registry-scan.sh scans SCAN_PATHS for projects with .claude/ directories.
Reports settings, CLAUDE.md, hooks.conf, skills, agents, and sync status.
Human-readable table by default, JSON with --json.
No hardcoded paths — reads from .env.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite README, update gitignore, delete replaced scripts</name>
  <files>
    README.md
    .gitignore
    gitignore_global
  </files>
  <action>
**README.md** — Complete rewrite to match current repo structure and deploy.sh system. Keep it concise (not the 194-line version). Structure:

```markdown
# dotclaude

Portable Claude Code configuration — settings, hooks, skills, and deployment for any machine.

## Quick Start

\`\`\`bash
git clone git@github.com:henrycgbaker/dotclaude.git ~/dotclaude
cd ~/dotclaude
./deploy.sh global
\`\`\`

## What It Does

dotclaude is the single source of truth for Claude Code configuration. It deploys via symlinks to `~/.claude/`, keeping everything in sync with this repo. CLAUDE.md is the one exception — it's built from toggleable section templates.

## Usage

| Command | Purpose |
|---------|---------|
| `deploy.sh global` | Set up ~/.claude/ (wizard on first run) |
| `deploy.sh global --interactive` | Re-run wizard |
| `deploy.sh global --target DIR` | Non-interactive deploy |
| `deploy.sh global --remote HOST` | Deploy to remote server |
| `deploy.sh project [path]` | Scaffold a project |
| `scripts/registry-scan.sh` | Scan projects for configs |

## Structure

\`\`\`
dotclaude/
├── deploy.sh              # Deployment script (replaces setup.sh)
├── .env.example           # Configuration template
├── settings.json          # Global settings source of truth
├── CLAUDE.md              # Current global CLAUDE.md
├── templates/
│   ├── claude-md/         # CLAUDE.md section templates
│   ├── settings/          # Project settings templates
│   └── hooks-conf/        # Git hook config presets
├── commands/              # Skills (/commit, /squash-merge, etc.)
├── hooks/                 # Claude Code hooks (PostToolUse, etc.)
├── githooks/              # Git hooks (commit-msg, pre-commit)
├── scripts/
│   ├── registry-scan.sh   # Project config scanner
│   └── lib/               # Shared bash functions
└── docs/
    └── usage-guide.md     # Comprehensive reference
\`\`\`

## Configuration

All settings live in `.env` (gitignored, per-machine). See `.env.example` for all options.

## GSD Coexistence

dotclaude and [GSD framework](https://github.com/get-shit-done-cc) coexist in `~/.claude/`. dotclaude uses file-level symlinks; GSD manages its own namespace. Neither touches the other's files.
```

Adjust as needed but keep it under 80 lines. Remove all references to deleted artefacts (agents/, skills/, project-agents/, sync-project-agents.sh, block-sensitive.py, etc.).

**Delete replaced scripts:**
- Delete `setup.sh` (replaced by deploy.sh)
- Delete `deploy-remote.sh` (replaced by deploy.sh global --remote)

**Update .gitignore:**
- Ensure `.env` is listed (not just `.env.example`)
- Add `.planning/` if not present
- Keep existing entries

**Review gitignore_global:**
- Remove stale reference to `~/.claude/rules/git-exclude.md` in comment (line 9)
- Update comment to reference deploy.sh instead of setup.sh
- Keep all actual gitignore patterns as-is (they're still valid)
- Ensure `.claude-project` pattern is present
  </action>
  <verify>
Check README updated: `grep "deploy.sh" README.md`

Check setup.sh deleted: `! test -f setup.sh && echo "setup.sh deleted"`

Check deploy-remote.sh deleted: `! test -f deploy-remote.sh && echo "deploy-remote.sh deleted"`

Check .env in gitignore: `grep "^\.env$" .gitignore`

Check gitignore_global no stale refs: `! grep "rules/" gitignore_global && echo "No stale refs"`

Check README under 80 lines: `wc -l README.md`
  </verify>
  <done>
README.md rewritten to match current repo and deploy.sh system.
setup.sh and deploy-remote.sh deleted (replaced by deploy.sh).
.gitignore includes .env. gitignore_global updated (stale refs removed).
Repo is clean with no dead scripts or stale documentation.
  </done>
</task>

</tasks>

<verification>
- Registry scanner passes bash syntax check and is executable
- README accurately describes current repo structure
- No deleted files remain (setup.sh, deploy-remote.sh)
- .gitignore and gitignore_global are current
- No stale references to rules/, agents/, skills/, sync-project-agents.sh
</verification>

<success_criteria>
- RGST-01: Registry scanner catalogues configs across projects
- README.md accurately documents the deploy.sh system
- setup.sh and deploy-remote.sh removed
- gitignore_global cleaned up
- Repo has no dead code or stale documentation
</success_criteria>

<output>
After completion, create `.planning/phases/03-settings-hooks-deploy-skills/03-07-SUMMARY.md`
</output>
