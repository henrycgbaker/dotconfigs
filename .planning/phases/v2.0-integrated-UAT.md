---
status: testing
phase: v2.0-integrated
source: All SUMMARY.md files from phases 04-09
started: 2026-02-09T17:15:00Z
updated: 2026-02-09T19:30:00Z
---

## Current Test

number: 11
name: Status Command
expected: |
  Run `./dotconfigs status` (after setup + deploy).
  Shows per-plugin deployment state with colour output.
awaiting: user response (paused — need to redo setup flow first)

## Tests

### 1. CLI Help and Usage
expected: Run `./dotconfigs` with no arguments. Shows usage with commands (global-configs, deploy, project-configs, status, list, help) and lists available plugins (claude, git).
result: pass

### 2. Contextual Help
expected: Run `./dotconfigs help deploy`. Shows deploy-specific help with --dry-run, --force, --interactive flags documented.
result: pass

### 3. Plugin Listing
expected: Run `./dotconfigs list`. Shows both "claude" and "git" plugins with "deployed" / "not deployed" status (not "installed").
result: pass

### 4. Invalid Plugin Error
expected: Run `./dotconfigs global-configs nonexistent`. Shows error message with list of available plugins (claude, git). Exits non-zero.
result: pass

### 5. Claude Global-Configs Wizard (First Run)
expected: Run `./dotconfigs global-configs claude` (with no existing .env). Shows category-based opt-in menu with 3 categories (Deploy targets, Content, Behaviour). User selects which categories to configure. Unselected items remain unset. Summary shown before saving with "[not managed]" for unselected configs.
result: issue
reported: "4 issues: (a) GSD install doesn't belong — npm handles it, remove from wizard. (b) Content items (sections, skills) should offer inline preview before selection. (c) Settings.json assembly is overengineered — simplify to single template (save analysis to .planning/ for future). (d) CLAUDE.md exclusion should offer 'both' option (root + all directories), not just one or the other."
severity: major

### 6. Git Global-Configs Wizard (First Run)
expected: Run `./dotconfigs global-configs git` (with no existing .env). Shows 4 categories (Identity, Workflow, Aliases, Hooks). Uses read-based numbered prompts (no `select` dropdown menus). Identity pre-fills from `git config --global`. Summary shown before saving.
result: issue
reported: "6 issues: (a) Confusing prompt format — '(default: value) [Y/n]' mixes opt-in question with config value, show value after opting in. (b) Aliases wording — 'manage' should be 'add'. (c) Hook deployment is all-or-nothing scope — needs per-hook granularity for scope (global vs project) and location (.git/hooks/ vs .githooks/). This is major. (d) Config path options should indicate tracked vs untracked. (e) Summary should show destination path (greyed out 'written to .env'). (f) Should offer .claude/hooks.conf as config path option (4th in hook search order)."
severity: major

### 7. Wizard Edit Mode (Re-run)
expected: Run `./dotconfigs global-configs claude` again after saving config. Enters edit mode showing numbered list of current config values. User can pick a number to edit specific items. "[not managed]" shown for unset configs.
result: issue
reported: "Edit mode is completely broken. 6 issues: (a) Number 13 rejected as invalid — selection logic broken. (b) Options repeating/garbled from item 7 onwards — display parsing bug. (c) Labels meaningless ('target: true', 'path: true', 'install: block-destructive.sh') — no context. (d) Full review needed — edit mode display is fundamentally broken. (e) Should offer 'rerun as new' (fresh wizard, overwrite) vs 'edit existing'. (f) First-run wizard doesn't offer claude hooks or skills configuration — missing from category menu."
severity: major

### 8. Deploy Dry Run
expected: Run `./dotconfigs deploy --dry-run` (after global-configs). Shows what would be deployed without making changes. Prints "Would create/Would link" messages. No filesystem changes made.
result: pass

### 9. Claude Deploy
expected: Run `./dotconfigs deploy claude` (after global-configs). Deploys settings.json (assembled from templates), CLAUDE.md, hooks, and skills to target directory. Applies CLAUDE.md exclusion to .git/info/exclude if enabled. Shows deploy summary with created/unchanged counts.
result: issue
reported: "Deploy crashes at CLAUDE.md build. Line 203 of deploy.sh does '> output_file' which fails when target is a broken symlink (user had CLAUDE.md -> old dotclaude repo). Deploy should detect and handle broken symlinks — remove and recreate, or warn."
severity: blocker

### 10. Git Deploy
expected: Run `./dotconfigs deploy git` (after global-configs). Applies git config --global settings (identity, workflow, aliases). Shows drift warnings if config differs from .env. Prints deploy summary.
result: pass

### 11. Status Command
expected: Run `./dotconfigs status`. Shows per-plugin deployment state with colour output. Claude shows per-file status (settings.json, CLAUDE.md, hooks, skills). Git shows per-config status (identity, workflow, aliases).
result: issue
reported: "Status command crashes silently. Root cause: set -e (line 4 of dotconfigs) + ((count_drift++)) when count_drift=0 — bash evaluates ((0)) as exit code 1, killing the script. Same bug likely affects all ((var++)) counters throughout codebase. Also: (a) error message on line 449 still says 'dots setup' instead of 'dotconfigs global-configs', (b) legacy 'setup' command still exists as broken minimal wizard."
severity: blocker

### 12. Deploy Idempotency
expected: Run `./dotconfigs deploy` twice. Second run shows "Unchanged" counts — no errors, no re-creation of existing files. Safe to run repeatedly.
result: [pending]

### 13. Project-Configs with G/L Badges
expected: From a git repo (not dotconfigs), run `dotconfigs project-configs .`. Shows globally-set values with cyan [G] badge. Local overrides shown with green [L] badge. Interactive wizard for project-level configuration.
result: [pending]

### 14. Git Hooks Exist
expected: Run `ls plugins/git/hooks/`. Should contain 7 hooks: commit-msg, pre-commit, pre-push, prepare-commit-msg, post-merge, post-checkout, post-rewrite. All executable.
result: [pending]

### 15. dots Symlink
expected: `dots` exists as a symlink pointing to `dotconfigs`. Running `./dots list` produces identical output to `./dotconfigs list`. Also: `dots` should get a PATH symlink too, not just `dotconfigs`.
result: [pending]

### 16. PATH Symlink
expected: After running `./dotconfigs deploy`, check if `~/.local/bin/dotconfigs` symlink exists. Verify `dotconfigs` is callable from another directory.
result: pass

### 17. Roster Generation
expected: Run `bash scripts/generate-roster.sh`. Generates docs/ROSTER.md with tables for 7 git hooks, 2 claude hooks, 4 commands. No errors.
result: [pending]

## Summary

total: 17
passed: 6
issues: 3 (major — wizard UX)
blockers_fixed: 2 (((var++)) crash, broken symlink crash)
pending: 6
skipped: 0

## Gaps

- truth: "Claude wizard offers appropriate opt-in categories without GSD install, with content previews, simple settings template, and both CLAUDE.md exclusion options"
  status: failed
  reason: "User reported: GSD install doesn't belong (npm), no content preview, settings assembly overengineered, CLAUDE.md exclusion missing 'both' option"
  severity: major
  test: 5
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Git wizard shows clear prompts, correct wording, granular hook scope control, and config path transparency"
  status: failed
  reason: "User reported: confusing default/question mixing, 'manage' should be 'add', all-or-nothing hook scope, no tracked/untracked indicators, no save path shown, missing .claude/hooks.conf option"
  severity: major
  test: 6
  root_cause: ""
  artifacts:
    - path: "plugins/git/setup.sh"
      issue: "Hook section needs per-hook scope/location granularity"
  missing: []
  debug_session: ""

- truth: "Edit mode shows clear labeled config values with working number selection"
  status: failed
  reason: "User reported: edit mode completely broken — garbled labels, non-functional selection, missing hook/skill config in first run, no 'rerun as new' option"
  severity: major
  test: 7
  root_cause: ""
  artifacts:
    - path: "plugins/claude/setup.sh"
      issue: "Edit mode display parsing broken from item 7 onwards"
  missing: []
  debug_session: ""

- truth: "Claude deploy handles broken symlinks and creates CLAUDE.md successfully"
  status: fixed
  reason: "User reported: deploy crashes at line 203 when CLAUDE.md is a broken symlink to old dotclaude repo"
  severity: blocker
  test: 9
  root_cause: "Line 203 does '> output_file' which fails on broken symlink — no detection/cleanup of stale symlinks before writing"
  fix: "Added broken symlink detection (-L && ! -e) and rm -f before writing, plus mkdir -p safety net in _claude_build_md"
  artifacts:
    - path: "plugins/claude/deploy.sh"
      issue: "FIXED: broken symlink check added before truncate"

- truth: "Status command shows deployment state visibly"
  status: fixed
  reason: "User reported: crashes silently even with valid .env + deploy done. bash -x trace shows crash at ((count_drift++)) when count_drift=0."
  severity: blocker
  test: 11
  root_cause: "Three issues: (1) ((var++)) when var=0 returns exit code 1 under set -e. (2) check_file_state() returned non-zero exit codes (1, 2) which also killed script under set -e. (3) stale 'dots setup' references."
  fix: "Replaced all ((var++)) with var=$((var + 1)) in claude/deploy.sh, git/deploy.sh. Changed check_file_state() to always return 0 (state communicated via stdout). Updated all 'dots' references to 'dotconfigs' across CLI and plugins."
  artifacts:
    - path: "plugins/claude/deploy.sh"
      issue: "FIXED: all ((var++)) replaced"
    - path: "plugins/git/deploy.sh"
      issue: "FIXED: all ((var++)) replaced"
    - path: "lib/symlinks.sh"
      issue: "FIXED: check_file_state always returns 0"
    - path: "dotconfigs"
      issue: "FIXED: all 'dots' references updated to 'dotconfigs'"

- truth: "Setup command performs one-time tool initialisation (deploy target, PATH, next-steps)"
  status: failed
  reason: "User reported: ./dotconfigs setup only asks deploy target — missing PATH setup, doesn't use 'dotconfigs' naming in output. Per 09-CONTEXT.md line 12 and 002-03-PLAN.md, setup should be its own command (not redirect to global-configs) that does one-time tool init."
  severity: major
  test: 11
  root_cause: "cmd_setup() was implemented as minimal deploy-target-only wizard. Missing PATH symlink creation and proper next-steps messaging with 'dotconfigs' naming."
  artifacts:
    - path: "dotconfigs"
      issue: "cmd_setup() lines 230-250: only asks deploy target, no PATH setup, uses 'dots' naming"
  missing:
    - "Add PATH symlink creation to setup (call _create_path_symlink)"
    - "Update next-steps message to use 'dotconfigs' naming"
    - "Add dots PATH symlink alongside dotconfigs"
  debug_session: ""
  requirements_source: "09-CONTEXT.md line 12: 'dots setup — one-time tool initialisation'; 002-03-PLAN.md lines 69-92"
