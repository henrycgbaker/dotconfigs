---
phase: quick-002
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/git/setup.sh
  - lib/wizard.sh
  - plugins/claude/setup.sh
autonomous: true

must_haves:
  truths:
    - "Git wizard menu displays once and accepts Enter for default"
    - "Space-separated env values are quoted in .env file"
    - ".env file can be sourced without errors"
  artifacts:
    - path: "plugins/git/setup.sh"
      provides: "Fixed select menu (no manual echo)"
      pattern: "PS3=.*select config_path in"
    - path: "lib/wizard.sh"
      provides: "wizard_save_env with quoting support"
      exports: ["wizard_save_env"]
  key_links:
    - from: "plugins/claude/setup.sh"
      to: "lib/wizard.sh:wizard_save_env"
      via: "quoted value parameter"
      pattern: 'wizard_save_env.*"\$sections_str"'
---

<objective>
Fix two critical bugs preventing proper wizard operation: git wizard menu loop and .env quoting issues.

Purpose: Wizards must work correctly before restructuring CLI commands
Output: Working wizards with proper bash select and quoted .env values
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@plugins/git/setup.sh
@lib/wizard.sh
@plugins/claude/setup.sh
</context>

<tasks>

<task type="auto">
  <name>Fix git wizard select menu loop</name>
  <files>plugins/git/setup.sh</files>
  <action>
Fix bash select statement bug at lines 196-222:

Problem: Manual echo before select causes double menu display, empty input rejected

Fix:
1. Remove manual echo of menu options (lines 200-204)
2. Keep PS3 prompt with default hint
3. Bash select auto-displays menu options numbered
4. Handle empty input (Enter) as accepting default

Pattern:
```bash
local config_default="${GIT_HOOK_CONFIG_PATH:-.githooks/config}"
PS3="Select config location [$config_default]: "
select config_path in ".githooks/config" ".claude/git-hooks.conf" ".git/hooks/hooks.conf" "custom"; do
    case "$config_path" in
        custom)
            read -p "Enter custom path: " config_path
            GIT_HOOK_CONFIG_PATH="$config_path"
            break
            ;;
        "")
            # Empty input (Enter) = accept default
            GIT_HOOK_CONFIG_PATH="$config_default"
            break
            ;;
        *)
            if [[ -n "$config_path" ]]; then
                GIT_HOOK_CONFIG_PATH="$config_path"
                break
            fi
            ;;
    esac
done
```

This is a bash 3.2 compatible fix (no -n flag needed on select).
  </action>
  <verify>
Run git wizard and test:
```bash
cd /Users/henrybaker/Repositories/dotconfigs
source lib/wizard.sh lib/discovery.sh lib/validation.sh lib/colours.sh lib/config.sh
source plugins/git/setup.sh
# Test would require interactive input, verify code pattern manually
grep -A 15 'PS3="Select config location' plugins/git/setup.sh | grep -q '"")'
```
  </verify>
  <done>Git wizard select menu appears once, accepts Enter for default, no loop</done>
</task>

<task type="auto">
  <name>Fix .env quoting for space-separated values</name>
  <files>lib/wizard.sh plugins/claude/setup.sh</files>
  <action>
Fix .env quoting bug for space-separated values:

1. Update `wizard_save_env` in lib/wizard.sh:
   - Add quoting to value parameter
   - Change line 103/105 from `${key}=${value}` to `${key}="${value}"`
   - Change line 109 from `echo "${key}=${value}"` to `echo "${key}=\"${value}\""`

2. Verify all calls in plugins/claude/setup.sh lines 23, 35-36 already pass quoted values (they do)

This ensures values like "section1 section2" become:
```
CLAUDE_MD_SECTIONS="section1 section2"
```
Not:
```
CLAUDE_MD_SECTIONS=section1 section2
```

The double quotes in the saved value allow sourcing without breaking on spaces.
  </action>
  <verify>
```bash
# Verify wizard_save_env adds quotes
grep -n 'echo "\${key}=\\"' lib/wizard.sh
grep -n 'sed.*\${key}=\\"' lib/wizard.sh

# Test sourcing
echo 'TEST_VAR="value with spaces"' > /tmp/test.env
source /tmp/test.env && [[ "$TEST_VAR" == "value with spaces" ]] && echo "PASS" || echo "FAIL"
rm /tmp/test.env
```
  </verify>
  <done>Space-separated values in .env are quoted, file can be sourced without errors</done>
</task>

</tasks>

<verification>
1. Git wizard config selection accepts Enter without looping
2. Generated .env file has quoted values for space-separated lists
3. No syntax errors when sourcing .env: `source .env && echo "OK"`
</verification>

<success_criteria>
- Git wizard select menu displays once per prompt
- Empty input (Enter) accepts default value
- All .env values are quoted
- .env can be sourced in bash without syntax errors
</success_criteria>

<output>
After completion, create `.planning/quick/002-fix-git-wizard-bug-restructure-cli-setup/002-01-SUMMARY.md`
</output>
