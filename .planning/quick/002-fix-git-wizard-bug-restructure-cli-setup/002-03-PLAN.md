---
phase: quick-002
plan: 03
type: execute
wave: 2
depends_on: ["002-02"]
files_modified:
  - dots
  - lib/wizard.sh
autonomous: true

must_haves:
  truths:
    - "'dots setup' initializes tool (PATH, deploy target)"
    - "'dots global-configs {plugin}' runs .env wizard"
    - "'dots project-configs {plugin}' runs project wizard"
    - "Old 'setup' command shows deprecation notice"
  artifacts:
    - path: "dots"
      provides: "New command structure"
      exports: ["cmd_setup", "cmd_global_configs", "cmd_project_configs"]
    - path: "lib/wizard.sh"
      provides: "Opt-in config selection helpers"
      exports: ["wizard_select_configs"]
  key_links:
    - from: "dots:cmd_global_configs"
      to: "plugins/*/setup.sh:plugin_*_setup"
      via: "sourcing and calling plugin wizard"
---

<objective>
Restructure CLI commands: setup → tool init, global-configs → .env wizard, project-configs → project wizard.

Purpose: Clear separation between tool setup and configuration management
Output: New command structure with backwards-compatible deprecation notices
</objective>

<execution_context>
@/Users/henrybaker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henrybaker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/quick/002-fix-git-wizard-bug-restructure-cli-setup/002-02-SUMMARY.md
@dots
@lib/wizard.sh
</context>

<tasks>

<task type="auto">
  <name>Implement new CLI command structure</name>
  <files>dots lib/wizard.sh</files>
  <action>
Restructure CLI commands in dots file:

**1. Rename existing cmd_setup → cmd_setup_legacy:**
- Move current cmd_setup (lines 180-200) to cmd_setup_legacy
- Add deprecation warning at start:
  ```bash
  echo "Warning: 'dots setup <plugin>' is deprecated" >&2
  echo "Use: 'dots global-configs <plugin>' to configure .env" >&2
  echo "" >&2
  ```
- Keep existing logic working for backwards compat

**2. Create new cmd_setup (tool initialization only):**
```bash
cmd_setup() {
    echo "dots — Tool Setup"
    echo ""

    # Deploy target
    local default_target="$HOME/.claude"
    wizard_prompt "Deploy target directory" "$default_target" DOTCONFIGS_DEPLOY_TARGET
    DOTCONFIGS_DEPLOY_TARGET="${DOTCONFIGS_DEPLOY_TARGET/#\~/$HOME}"

    # Save to .env
    wizard_save_env "$ENV_FILE" "DOTCONFIGS_DEPLOY_TARGET" "$DOTCONFIGS_DEPLOY_TARGET"

    echo ""
    echo "Setup complete. Configuration saved to .env"
    echo ""
    echo "Next steps:"
    echo "  1. Run 'dots global-configs <plugin>' to configure plugins"
    echo "  2. Run 'dots deploy' to deploy configurations"
    echo "  3. Use 'dots --help' for all commands"
    echo ""
}
```

**3. Create new cmd_global_configs:**
```bash
cmd_global_configs() {
    local plugin=$1

    if [[ -z "$plugin" ]]; then
        echo "Error: Plugin name required" >&2
        echo "Usage: dots global-configs <plugin>" >&2
        echo "" >&2
        list_available_plugins
        exit 1
    fi

    if ! plugin_exists "$plugin"; then
        echo "Error: Plugin '$plugin' not found" >&2
        list_available_plugins
        exit 1
    fi

    # Load and run plugin wizard
    source "$PLUGINS_DIR/$plugin/setup.sh"
    "plugin_${plugin}_setup" "$@"
}
```

**4. Create new cmd_project_configs:**
- Rename current cmd_project → cmd_project_configs
- Keep all existing logic (lines 453-533)
- Update internal messaging to reference 'project-configs'

**5. Update main() command routing:**
```bash
case "$1" in
    setup)
        # Check if plugin arg provided (legacy mode)
        if [[ $# -gt 1 ]]; then
            cmd_setup_legacy "${@:2}"
        else
            cmd_setup
        fi
        ;;
    global-configs)
        cmd_global_configs "${@:2}"
        ;;
    project-configs)
        cmd_project_configs "${@:2}"
        ;;
    project)
        echo "Warning: 'dots project' is deprecated" >&2
        echo "Use: 'dots project-configs' instead" >&2
        echo "" >&2
        cmd_project_configs "${@:2}"
        ;;
    deploy|status|list|help|--help|-h)
        # existing handlers
        ;;
esac
```

**6. Update show_usage() help text:**
```
Usage:
  dots setup                              Initialize tool (deploy target, PATH)
  dots global-configs <plugin>            Configure plugin defaults (.env)
  dots project-configs [plugin] <path>    Configure per-project overrides
  dots deploy [plugin] [options]          Deploy configuration to filesystem
  dots status [plugin]                    Show deployment status
  dots list                               List available plugins
  dots help [command]                     Show help for command

Examples:
  dots setup                              Initialize dotconfigs
  dots global-configs claude              Configure Claude defaults
  dots project-configs claude .           Override Claude config for project
  dots deploy                             Deploy all configurations
```

**7. Add new help entries for global-configs and project-configs in show_command_help()**
  </action>
  <verify>
```bash
# Verify new commands exist
./dots setup 2>&1 | grep -q "Deploy target directory" && echo "PASS: new setup" || echo "FAIL"
./dots global-configs 2>&1 | grep -q "Plugin name required" && echo "PASS: global-configs" || echo "FAIL"
./dots project-configs 2>&1 | grep -q "git repository" && echo "PASS: project-configs" || echo "FAIL"

# Verify backwards compat
./dots setup claude 2>&1 | grep -q "deprecated" && echo "PASS: legacy warning" || echo "FAIL"
./dots project 2>&1 | grep -q "deprecated" && echo "PASS: project deprecation" || echo "FAIL"

# Verify help updated
./dots --help | grep -q "global-configs" && echo "PASS: help" || echo "FAIL"
```
  </verify>
  <done>CLI commands restructured: setup = tool init, global-configs = wizard, project-configs = project setup</done>
</task>

</tasks>

<verification>
1. `dots setup` runs tool initialization (deploy target only)
2. `dots global-configs claude` runs Claude wizard
3. `dots project-configs claude .` runs project scaffold
4. Legacy `dots setup claude` shows deprecation warning but still works
5. Help text reflects new command structure
</verification>

<success_criteria>
- New commands functional and documented
- Backwards compatibility maintained with warnings
- Clear separation: setup = tool, global-configs = .env, project-configs = projects
</success_criteria>

<output>
After completion, create `.planning/quick/002-fix-git-wizard-bug-restructure-cli-setup/002-03-SUMMARY.md`
</output>
